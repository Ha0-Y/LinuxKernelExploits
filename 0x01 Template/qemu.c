#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <stdint.h>
#include <string.h>
#include <errno.h>
#include <signal.h>
#include <fcntl.h>
#include <ctype.h>
#include <termios.h>
#include <assert.h>
#include <sys/types.h>
#include <sys/mman.h>
#include <sys/io.h>

char *mmio_mem;
int pmio_base = 0xc040;

#define TYPE size_t

void pmio_write(uint32_t addr, uint32_t value)
{
	outl(value, pmio_base + addr);
}

uint64_t pmio_read(uint32_t addr)
{
	return inl(pmio_base + addr);
}


void mmio_write(uint64_t addr, char value) {
	*(TYPE *)(mmio_mem + addr) = value;
}

uint64_t mmio_read(uint64_t addr) {
	return *( (TYPE *)(mmio_mem + addr) );
}

/*
 * 使用mmio
 */
void mmio() {
	int fd = open("/sys/devices/pci0000:00/0000:00:04.0/resource0", O_RDWR | O_SYNC);
	if (fd == -1) {
		perror("mmio_fd open failed");
		exit(-1);
	}
	mmio_mem = mmap(0, 0x1000, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0);
	if (mmio_mem == MAP_FAILED) {
		perror("mmap mmio_mem failed");
		exit(-1);
	}
}
/*
 * 使用pmio模型
 */
void pmio() {
	if (iopl(3) !=0 ){
		perror("I/O permission is not enough");
		exit(-1);
	}
}

int main()
{
	return 0;
}