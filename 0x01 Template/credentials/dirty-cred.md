## dirty cred

>无地址依赖的漏洞利用方式，灵感来自于 DirtyPipe。
> Zhenpeng Lin 博士在 2022-CCS 发表的论文 DirtyCred: Escalating Privilege in Linux Kernel，Dirty Cred 是该论文中提到的一种新的内核漏洞利用思路，同时也在Black Hat中作为议题。

- 记得 kernel pwn 入门时，[UAF](https://ctf-wiki.org/pwn/linux/kernel-mode/exploitation/heap/slub/uaf/)漏洞直接将 cred 结构体给覆盖掉部分uid,gid从而进行提权，但是现在那种方法好像不能用了，因为cred有着自己的slab

### 内核凭证

在这里主要利用 `task credentials` 和 `open file credentials`，具体表现为 `struct cred` & `struct file`

- struct cred 见 [cred](./cred.md) 的文章
- struct file 见 [file](./file.md) 的文章

### slab 分类

#### 通用内存slab

在内核中，直接调用kmalloc 分配的内存，如果特别大(大于一页)则会直接调用伙伴系统申请页面。否则会调用通用slab 进行分配。

#### 特殊内存slab

内核中常用的结构体会使用 `kmem_cache_create`创造的独特的slab,增快速度.

## Exploit

内核中对权限/身份的校验发生在具体操作之前，而**校验身份的动作往往不会被锁限制**。那么我们可以卡在身份验证和操作之间将目标结构替换掉来完成漏洞利用。这可能需要一些手段来将非内核凭证 slab 的漏洞转换为内核凭证 slab 区域的漏洞，和一些延长身份验证和具体操作之间的时间窗的手段。

### free credentials

### allocate privileged credentials as unprivileged users.

### stabilize file exploitation

## 参考

- [US-22-Lin-Cautious-A-New-Exploitation-Method](https://i.blackhat.com/USA-22/Thursday/US-22-Lin-Cautious-A-New-Exploitation-Method.pdf)
- [paper DirtyCred](https://zplin.me/papers/DirtyCred.pdf)