#include <sys/shm.h>

// size: 0x20 kmalloc-32
// 内核基址：可泄露。其ns、vm_ops指针可以泄露
// heap：可泄露。file指向堆区域
// shm_file_data 的 file 域为一个 file 结构体，位于线性映射区中，若能泄露 file 域则同样能泄漏出内核的“堆上地址”

struct shm_file_data {
  int id;
  struct ipc_namespace *ns;
  struct file *file;
  const struct vm_operations_struct *vm_ops;
};

// shmdt(shmaddr); 关闭
int shmid_open() {
  int shmid;
  if ((shmid = shmget(IPC_PRIVATE, 100, 0600)) == -1) {
    fatal("Error shmget");
  }
  char *shmaddr = shmat(shmid, NULL, 0);
  if (shmaddr == (void *)-1) {
    fatal("Error shmat");
  }
  return shmid;
}