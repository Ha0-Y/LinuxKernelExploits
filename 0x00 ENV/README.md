## 复现环境的搭建

目前还是使用 `qemu` + `busybox` + 自己编译内核实现环境

- qemu: `apt install qemu-system_x86_64`
- busybox: [参考 blog](https://www.renshengjihe.cn/1fe7a0c955f0#%E6%9E%84%E5%BB%BA%E6%A0%B9%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F)
- 内核版本： [USTC mirror](https://mirrors.ustc.edu.cn/kernel.org/)

内核编译坑很多，使用 docker 编译比较好，高版本gcc编译某些内核时特别容易出错

### 编译

- 可以参考 [basic.pdf](./basic.pdf)

1. config
```bash
make  menuconfig

# 如果使用LLVM
make CC=clang HOSTCC=clang -j8 bzImage  # 非完整版
```

编译内核时保证勾选如下配置（默认都是y，并且根据版本会有一定的变化）：
- Kernel hacking —> Kernel debugging
- Kernel hacking —> Compile-time checks and compiler options —> Compile the kernel with debug info
- Kernel hacking —> Generic Kernel Debugging Instruments –> KGDB: kernel debugger
- kernel hacking —> Compile the kernel with frame pointers

2. 内核，由于使用完整的LLVM工具链在某些版本的会出错，比如`llvm-ar not found`，存在`llvm-ar-14`,在某些内核版本编译时出错，因此使用部分的LLVM链就行
```bash
make -j8 bzImage

# 使用clang
make CC=clang HOSTCC=clang -j8 bzImage
# or
make LLVM=1 -j8 bzImage
# or
make LLVM=-15 -j8 bzImage
```